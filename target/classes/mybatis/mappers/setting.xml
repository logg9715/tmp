<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.setting">
	<select id="select_manager_data" resultType="java.util.Map" parameterType="java.util.Map">
		select *,
		case when tmi_level=90 then '관리자'
		     when tmi_level=85 then '계약관리'
		     when tmi_level=80 then '팀장'
		     when tmi_level=0 then '요청'
		     else '직원'
		end as levelName, convert(varchar(19), tmi_regdate, 121) as regDate
		from tbl_manager_info left outer join tbl_group_info on tmi_tgicode=tgi_code
  		where tmi_level != 100
  		<choose>
  			<when test="searchType == 1 and searchData != ''"> and tmi_name like '%' + #{searchData} + '%' </when>
  			<when test="searchType == 2 and searchData != ''"> and tmi_id like '%' + #{searchData} + '%' </when>
		</choose>
  		order by tmi_code desc
	</select>

	<select id="select_detail_userinfo" resultType="java.util.Map" parameterType="int">
		select top 1 * from tbl_manager_info where tmi_code=${value}
	</select>
	
	<insert id="insert_user_info" parameterType="java.util.Map">
		insert into tbl_manager_info(
			tmi_id,
			tmi_pwd,
			tmi_email,
			tmi_name,
			tmi_tel,
			tmi_tel1,
			tmi_tgicode,
			tmi_is_logined,
			tmi_level
		) values(
			#{edit_user_id},
			#{edit_user_pwd},
			#{edit_user_email},
			#{edit_user_name},
			#{edit_user_cp1},
			#{edit_user_cp2},
			#{edit_user_group},
			0,
			#{edit_user_level}			
		)
	</insert>
	
	<update id="update_user_info" parameterType="java.util.Map">
		update tbl_manager_info set
			tmi_id=#{edit_user_id},
			tmi_pwd=#{edit_user_pwd},
			tmi_email=#{edit_user_email},
			tmi_name=#{edit_user_name},
			tmi_tel=#{edit_user_cp1},
			tmi_tel1=#{edit_user_cp2},
			tmi_tgicode=#{edit_user_group},
			tmi_level=#{edit_user_level} where tmi_code=#{userCode}
	</update>
	
	<select id="select_update_overlapcheck" resultType="int" parameterType="java.util.Map">
		select count(tmi_code) from tbl_manager_info where tmi_id=#{edit_user_id} and tmi_code != ${userCode} 
	</select>
	
	<delete id="delete_user_info" parameterType="int">
    	delete from tbl_manager_info where tmi_code=${value};
	</delete>
	
	<select id="select_overlapcheck_typename" resultType="int" parameterType="String">
		select count(tst_code) from tbl_sales_type where tst_name=#{_parameter} 
	</select>
	
	<insert id="insert_sales_type" parameterType="java.util.Map">
		insert into tbl_sales_type(
			tst_name
		) values(
			#{typeName}		
		)
	</insert>	
	
	<select id="select_update_overlaptypecheck" resultType="int" parameterType="java.util.Map">
		select count(tst_code) from tbl_sales_type where tst_name=#{typeName} and tst_code != ${typeCode} 
	</select>	
	
	<update id="update_sales_type" parameterType="java.util.Map">
		update tbl_sales_type set tst_name=#{typeName} where tst_code=#{typeCode}
	</update>
	
	<select id="select_detail_salestypeinfo" resultType="java.util.Map" parameterType="int">
		select top 1 * from tbl_sales_type where tst_code=${value}
	</select>
	
	<select id="select_salestype_data" resultType="java.util.Map">
		select * from tbl_sales_type order by tst_code desc
	</select>
	
	<delete id="delete_salestype_info" parameterType="int">
    	delete from tbl_sales_type where tst_code=${value};
	</delete>	
	
	<select id="select_overlapcheck_company" resultType="int" parameterType="String">
		select count(tpc_code) from tbl_pay_company where tpc_name=#{_parameter} 
	</select>
	
	<insert id="insert_contract_company" parameterType="java.util.Map">
		insert into tbl_pay_company(
			tpc_name,
			tpc_selected
		) values(
			#{companyName},		
			0		
		)
	</insert>	
		
	<select id="select_update_overlapcompanycheck" resultType="int" parameterType="java.util.Map">
		select count(tpc_code) from tbl_pay_company where tpc_name=#{companyName} and tpc_code != ${companyCode} 
	</select>	
	
	<update id="update_contract_company" parameterType="java.util.Map">
		update tbl_pay_company set tpc_name=#{companyName} where tpc_code=#{companyCode}
	</update>
	
	<select id="select_detail_contractcompanyinfo" resultType="java.util.Map" parameterType="int">
		select top 1 * from tbl_pay_company where tpc_code=${value}
	</select>
	
	<select id="select_contractcompany_data" resultType="java.util.Map">
		select * from tbl_pay_company order by tpc_code desc
	</select>
	
	<delete id="delete_contractcompany_info" parameterType="int">
    	delete from tbl_pay_company where tpc_code=${value};
	</delete>		
</mapper>
